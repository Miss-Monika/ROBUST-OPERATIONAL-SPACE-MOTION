clear all;clc;


syms  th1 th2 th3 th4 th5 th1dot th2dot th3dot th4dot th5dot th1ddot th2ddot th3ddot th4ddot th5ddot;
syms m1 m2 m3 m4 m5 g;
syms waist_width crus thigh spine shoulder bicep_arm forearm; % length of parts

L = (m5*(crus*th1dot*cos(th1) - bicep_arm*cos(th1 - th2 + th3 - th4)*(th1dot - th2dot + th3dot - th4dot) + thigh*cos(th1 - th2)*(th1dot - th2dot) + spine*cos(th1 - th2 + th3)*(th1dot - th2dot + th3dot))^2)/2 + (m4*(spine*sin(th1 - th2 + th3)*(th1dot - th2dot + th3dot) + crus*th1dot*sin(th1) - (bicep_arm*sin(th1 - th2 + th3 - th4)*(th1dot - th2dot + th3dot - th4dot))/2 + thigh*sin(th1 - th2)*(th1dot - th2dot))^2)/2 + (m4*(crus*th1dot*cos(th1) + thigh*cos(th1 - th2)*(th1dot - th2dot) + spine*cos(th1 - th2 + th3)*(th1dot - th2dot + th3dot))^2)/2 + (m3*(crus*th1dot*cos(th1) + thigh*cos(th1 - th2)*(th1dot - th2dot))^2)/2 + (m2*(crus*th1dot*sin(th1) + (thigh*sin(th1 - th2)*(th1dot - th2dot))/2)^2)/2 + (m3*((spine*sin(th1 - th2 + th3)*(th1dot - th2dot + th3dot))/2 + crus*th1dot*sin(th1) + thigh*sin(th1 - th2)*(th1dot - th2dot))^2)/2 + (m5*(spine*sin(th1 - th2 + th3)*(th1dot - th2dot + th3dot) + (forearm*sin(th1 - th2 + th3 - th4 - th5)*(th2dot - th1dot - th3dot + th4dot + th5dot))/2 + crus*th1dot*sin(th1) - bicep_arm*sin(th1 - th2 + th3 - th4)*(th1dot - th2dot + th3dot - th4dot) + thigh*sin(th1 - th2)*(th1dot - th2dot))^2)/2 - g*m3*(crus*cos(th1) + (spine*cos(th1 - th2 + th3))/2 + thigh*cos(th1 - th2) + 1/20) - g*m5*(crus*cos(th1) - (forearm*cos(th1 - th2 + th3 - th4 - th5))/2 + spine*cos(th1 - th2 + th3) + thigh*cos(th1 - th2) - bicep_arm*cos(th1 - th2 + th3 - th4) + 1/20) - g*m2*(crus*cos(th1) + (thigh*cos(th1 - th2))/2 + 1/20) - g*m1*((crus*cos(th1))/2 + 1/20) - g*m4*(crus*cos(th1) + spine*cos(th1 - th2 + th3) + thigh*cos(th1 - th2) - (bicep_arm*cos(th1 - th2 + th3 - th4))/2 + 1/20) + (crus^2*m2*th1dot^2*cos(th1)^2)/2 + (crus^2*m1*th1dot^2*sin(th1)^2)/8;

P1=diff(L,th1);
P2=diff(L,th2);
P3=diff(L,th3);
P4=diff(L,th4);
P5=diff(L,th5);

P=P1+P2+P3+P4+P5;%differentiation of L wrt th

Q1=diff(L,th1dot);
Q2=diff(L,th2dot);
Q3=diff(L,th3dot);
Q4=diff(L,th4dot);
Q5=diff(L,th5dot);

%  (d/dt)(dL/d_thdot)

R1=m2*(crus*th1dot*cos(th1) + (thigh*cos(th1 - th2)*(th1dot - th2dot))/2)*(crus*sin(th1)*th1dot + (thigh*sin(th1 - th2)*(th1dot - th2dot))/2) - m3*(crus*th1dot*sin(th1) + thigh*sin(th1 - th2)*(th1dot - th2dot))*(thigh*cos(th1 - th2)*(th1dot - th2dot) + crus*cos(th1)*th1dot) + m3*(crus*cos(th1) + thigh*cos(th1 - th2))*(crus*th1ddot*cos(th1) + thigh*cos(th1 - th2)*(th1ddot - th2ddot) - crus*th1dot*sin(th1)*th1dot - thigh*sin(th1 - th2)*(th1dot - th2dot)*(th1dot - th2dot)) - m4*(spine*sin(th1 - th2 + th3)*(th1dot - th2dot + th3dot) + crus*th1dot*sin(th1) + thigh*sin(th1 - th2)*(th1dot - th2dot))*(spine*cos(th1 - th2 + th3)*(th1dot - th2dot + th3dot) + thigh*cos(th1 - th2)*(th1dot - th2dot) + crus*cos(th1)*th1dot) + m3*(crus*sin(th1)*th1dot + (spine*sin(th1 - th2 + th3)*(th1dot - th2dot + th3dot))/2 + thigh*sin(th1 - th2)*(th1dot - th2dot))*(crus*th1dot*cos(th1) + thigh*cos(th1 - th2)*(th1dot - th2dot) + (spine*cos(th1 - th2 + th3)*(th1dot - th2dot + th3dot))/2) + m4*(crus*cos(th1) + spine*cos(th1 - th2 + th3) + thigh*cos(th1 - th2))*(crus*th1ddot*cos(th1) + thigh*cos(th1 - th2)*(th1ddot - th2ddot) + spine*cos(th1 - th2 + th3)*(th1ddot - th2ddot + th3ddot) - crus*th1dot*sin(th1)*th1dot - spine*sin(th1 - th2 + th3)*(th1dot - th2dot + th3dot)*(th1dot - th2dot + th3dot) - thigh*sin(th1 - th2)*(th1dot - th2dot)*(th1dot - th2dot)) + m2*(crus*sin(th1) + (thigh*sin(th1 - th2))/2)*(crus*th1ddot*sin(th1) + (thigh*sin(th1 - th2)*(th1ddot - th2ddot))/2 + crus*th1dot*cos(th1)*th1dot + (thigh*cos(th1 - th2)*(th1dot - th2dot)*(th1dot - th2dot))/2) + m5*(crus*cos(th1) + spine*cos(th1 - th2 + th3) + thigh*cos(th1 - th2) - bicep_arm*cos(th1 - th2 + th3 - th4))*(crus*th1ddot*cos(th1) - bicep_arm*cos(th1 - th2 + th3 - th4)*(th1ddot - th2ddot + th3ddot - th4ddot) + thigh*cos(th1 - th2)*(th1ddot - th2ddot) + spine*cos(th1 - th2 + th3)*(th1ddot - th2ddot + th3ddot) - crus*th1dot*sin(th1)*th1dot - spine*sin(th1 - th2 + th3)*(th1dot - th2dot + th3dot)*(th1dot - th2dot + th3dot) - thigh*sin(th1 - th2)*(th1dot - th2dot)*(th1dot - th2dot) + bicep_arm*sin(th1 - th2 + th3 - th4)*(th1dot - th2dot + th3dot - th4dot)*(th1dot - th2dot + th3dot - th4dot)) + m3*(crus*sin(th1) + (spine*sin(th1 - th2 + th3))/2 + thigh*sin(th1 - th2))*((spine*sin(th1 - th2 + th3)*(th1ddot - th2ddot + th3ddot))/2 + crus*th1ddot*sin(th1) + thigh*sin(th1 - th2)*(th1ddot - th2ddot) + crus*th1dot*cos(th1)*th1dot + (spine*cos(th1 - th2 + th3)*(th1dot - th2dot + th3dot)*(th1dot - th2dot + th3dot))/2 + thigh*cos(th1 - th2)*(th1dot - th2dot)*(th1dot - th2dot)) - m5*(spine*sin(th1 - th2 + th3)*(th1dot - th2dot + th3dot) + crus*th1dot*sin(th1) - bicep_arm*sin(th1 - th2 + th3 - th4)*(th1dot - th2dot + th3dot - th4dot) + thigh*sin(th1 - th2)*(th1dot - th2dot))*(spine*cos(th1 - th2 + th3)*(th1dot - th2dot + th3dot) + thigh*cos(th1 - th2)*(th1dot - th2dot) - bicep_arm*cos(th1 - th2 + th3 - th4)*(th1dot - th2dot + th3dot - th4dot) + crus*cos(th1)*th1dot) + m4*(crus*th1dot*cos(th1) - (bicep_arm*cos(th1 - th2 + th3 - th4)*(th1dot - th2dot + th3dot - th4dot))/2 + thigh*cos(th1 - th2)*(th1dot - th2dot) + spine*cos(th1 - th2 + th3)*(th1dot - th2dot + th3dot))*(crus*sin(th1)*th1dot + spine*sin(th1 - th2 + th3)*(th1dot - th2dot + th3dot) + thigh*sin(th1 - th2)*(th1dot - th2dot) - (bicep_arm*sin(th1 - th2 + th3 - th4)*(th1dot - th2dot + th3dot - th4dot))/2) + m4*(crus*sin(th1) + spine*sin(th1 - th2 + th3) + thigh*sin(th1 - th2) - (bicep_arm*sin(th1 - th2 + th3 - th4))/2)*(spine*sin(th1 - th2 + th3)*(th1ddot - th2ddot + th3ddot) + crus*th1ddot*sin(th1) - (bicep_arm*sin(th1 - th2 + th3 - th4)*(th1ddot - th2ddot + th3ddot - th4ddot))/2 + thigh*sin(th1 - th2)*(th1ddot - th2ddot) + crus*th1dot*cos(th1)*th1dot + spine*cos(th1 - th2 + th3)*(th1dot - th2dot + th3dot)*(th1dot - th2dot + th3dot) + thigh*cos(th1 - th2)*(th1dot - th2dot)*(th1dot - th2dot) - (bicep_arm*cos(th1 - th2 + th3 - th4)*(th1dot - th2dot + th3dot - th4dot)*(th1dot - th2dot + th3dot - th4dot))/2) + m5*((forearm*cos(th1 - th2 + th3 - th4 - th5)*(th2dot - th1dot - th3dot + th4dot + th5dot))/2 + crus*th1dot*cos(th1) - bicep_arm*cos(th1 - th2 + th3 - th4)*(th1dot - th2dot + th3dot - th4dot) + thigh*cos(th1 - th2)*(th1dot - th2dot) + spine*cos(th1 - th2 + th3)*(th1dot - th2dot + th3dot))*(crus*sin(th1)*th1dot + spine*sin(th1 - th2 + th3)*(th1dot - th2dot + th3dot) + thigh*sin(th1 - th2)*(th1dot - th2dot) - bicep_arm*sin(th1 - th2 + th3 - th4)*(th1dot - th2dot + th3dot - th4dot) + (forearm*sin(th1 - th2 + th3 - th4 - th5)*(th2dot - th1dot - th3dot + th4dot + th5dot))/2) + m5*(crus*sin(th1) - (forearm*sin(th1 - th2 + th3 - th4 - th5))/2 + spine*sin(th1 - th2 + th3) + thigh*sin(th1 - th2) - bicep_arm*sin(th1 - th2 + th3 - th4))*(spine*sin(th1 - th2 + th3)*(th1ddot - th2ddot + th3ddot) + (forearm*sin(th1 - th2 + th3 - th4 - th5)*(th2ddot - th1ddot - th3ddot + th4ddot + th5ddot))/2 + crus*th1ddot*sin(th1) - bicep_arm*sin(th1 - th2 + th3 - th4)*(th1ddot - th2ddot + th3ddot - th4ddot) + thigh*sin(th1 - th2)*(th1ddot - th2ddot) + crus*th1dot*cos(th1)*th1dot + spine*cos(th1 - th2 + th3)*(th1dot - th2dot + th3dot)*(th1dot - th2dot + th3dot) + thigh*cos(th1 - th2)*(th1dot - th2dot)*(th1dot - th2dot) - bicep_arm*cos(th1 - th2 + th3 - th4)*(th1dot - th2dot + th3dot - th4dot)*(th1dot - th2dot + th3dot - th4dot) - (forearm*cos(th1 - th2 + th3 - th4 - th5)*(th2dot - th1dot - th3dot + th4dot + th5dot)*(th2dot - th1dot - th3dot + th4dot + th5dot))/2) + crus^2*m2*th1ddot*cos(th1)^2 + (crus^2*m1*th1ddot*sin(th1)^2)/4 + (crus^2*m1*th1dot*cos(th1)*sin(th1)*th1dot)/2 - 2*crus^2*m2*th1dot*cos(th1)*sin(th1)*th1dot;

R2=m5*(spine*sin(th1 - th2 + th3)*(th1dot - th2dot + th3dot) - bicep_arm*sin(th1 - th2 + th3 - th4)*(th1dot - th2dot + th3dot - th4dot) + thigh*sin(th1 - th2)*(th1dot - th2dot))*(spine*cos(th1 - th2 + th3)*(th1dot - th2dot + th3dot) + thigh*cos(th1 - th2)*(th1dot - th2dot) - bicep_arm*cos(th1 - th2 + th3 - th4)*(th1dot - th2dot + th3dot - th4dot) + crus*cos(th1)*th1dot) - m4*(spine*cos(th1 - th2 + th3) + thigh*cos(th1 - th2))*(crus*th1ddot*cos(th1) + thigh*cos(th1 - th2)*(th1ddot - th2ddot) + spine*cos(th1 - th2 + th3)*(th1ddot - th2ddot + th3ddot) - crus*th1dot*sin(th1)*th1dot - spine*sin(th1 - th2 + th3)*(th1dot - th2dot + th3dot)*(th1dot - th2dot + th3dot) - thigh*sin(th1 - th2)*(th1dot - th2dot)*(th1dot - th2dot)) - m5*(spine*cos(th1 - th2 + th3) + thigh*cos(th1 - th2) - bicep_arm*cos(th1 - th2 + th3 - th4))*(crus*th1ddot*cos(th1) - bicep_arm*cos(th1 - th2 + th3 - th4)*(th1ddot - th2ddot + th3ddot - th4ddot) + thigh*cos(th1 - th2)*(th1ddot - th2ddot) + spine*cos(th1 - th2 + th3)*(th1ddot - th2ddot + th3ddot) - crus*th1dot*sin(th1)*th1dot - spine*sin(th1 - th2 + th3)*(th1dot - th2dot + th3dot)*(th1dot - th2dot + th3dot) - thigh*sin(th1 - th2)*(th1dot - th2dot)*(th1dot - th2dot) + bicep_arm*sin(th1 - th2 + th3 - th4)*(th1dot - th2dot + th3dot - th4dot)*(th1dot - th2dot + th3dot - th4dot)) - m3*((spine*sin(th1 - th2 + th3))/2 + thigh*sin(th1 - th2))*((spine*sin(th1 - th2 + th3)*(th1ddot - th2ddot + th3ddot))/2 + crus*th1ddot*sin(th1) + thigh*sin(th1 - th2)*(th1ddot - th2ddot) + crus*th1dot*cos(th1)*th1dot + (spine*cos(th1 - th2 + th3)*(th1dot - th2dot + th3dot)*(th1dot - th2dot + th3dot))/2 + thigh*cos(th1 - th2)*(th1dot - th2dot)*(th1dot - th2dot)) - m3*(thigh*cos(th1 - th2)*(th1dot - th2dot) + (spine*cos(th1 - th2 + th3)*(th1dot - th2dot + th3dot))/2)*(crus*sin(th1)*th1dot + (spine*sin(th1 - th2 + th3)*(th1dot - th2dot + th3dot))/2 + thigh*sin(th1 - th2)*(th1dot - th2dot)) - m4*(thigh*cos(th1 - th2)*(th1dot - th2dot) - (bicep_arm*cos(th1 - th2 + th3 - th4)*(th1dot - th2dot + th3dot - th4dot))/2 + spine*cos(th1 - th2 + th3)*(th1dot - th2dot + th3dot))*(crus*sin(th1)*th1dot + spine*sin(th1 - th2 + th3)*(th1dot - th2dot + th3dot) + thigh*sin(th1 - th2)*(th1dot - th2dot) - (bicep_arm*sin(th1 - th2 + th3 - th4)*(th1dot - th2dot + th3dot - th4dot))/2) - m5*((forearm*cos(th1 - th2 + th3 - th4 - th5)*(th2dot - th1dot - th3dot + th4dot + th5dot))/2 - bicep_arm*cos(th1 - th2 + th3 - th4)*(th1dot - th2dot + th3dot - th4dot) + thigh*cos(th1 - th2)*(th1dot - th2dot) + spine*cos(th1 - th2 + th3)*(th1dot - th2dot + th3dot))*(crus*sin(th1)*th1dot + spine*sin(th1 - th2 + th3)*(th1dot - th2dot + th3dot) + thigh*sin(th1 - th2)*(th1dot - th2dot) - bicep_arm*sin(th1 - th2 + th3 - th4)*(th1dot - th2dot + th3dot - th4dot) + (forearm*sin(th1 - th2 + th3 - th4 - th5)*(th2dot - th1dot - th3dot + th4dot + th5dot))/2) - m4*(spine*sin(th1 - th2 + th3) + thigh*sin(th1 - th2) - (bicep_arm*sin(th1 - th2 + th3 - th4))/2)*(spine*sin(th1 - th2 + th3)*(th1ddot - th2ddot + th3ddot) + crus*th1ddot*sin(th1) - (bicep_arm*sin(th1 - th2 + th3 - th4)*(th1ddot - th2ddot + th3ddot - th4ddot))/2 + thigh*sin(th1 - th2)*(th1ddot - th2ddot) + crus*th1dot*cos(th1)*th1dot + spine*cos(th1 - th2 + th3)*(th1dot - th2dot + th3dot)*(th1dot - th2dot + th3dot) + thigh*cos(th1 - th2)*(th1dot - th2dot)*(th1dot - th2dot) - (bicep_arm*cos(th1 - th2 + th3 - th4)*(th1dot - th2dot + th3dot - th4dot)*(th1dot - th2dot + th3dot - th4dot))/2) + m5*((forearm*sin(th1 - th2 + th3 - th4 - th5))/2 - spine*sin(th1 - th2 + th3) - thigh*sin(th1 - th2) + bicep_arm*sin(th1 - th2 + th3 - th4))*(spine*sin(th1 - th2 + th3)*(th1ddot - th2ddot + th3ddot) + (forearm*sin(th1 - th2 + th3 - th4 - th5)*(th2ddot - th1ddot - th3ddot + th4ddot + th5ddot))/2 + crus*th1ddot*sin(th1) - bicep_arm*sin(th1 - th2 + th3 - th4)*(th1ddot - th2ddot + th3ddot - th4ddot) + thigh*sin(th1 - th2)*(th1ddot - th2ddot) + crus*th1dot*cos(th1)*th1dot + spine*cos(th1 - th2 + th3)*(th1dot - th2dot + th3dot)*(th1dot - th2dot + th3dot) + thigh*cos(th1 - th2)*(th1dot - th2dot)*(th1dot - th2dot) - bicep_arm*cos(th1 - th2 + th3 - th4)*(th1dot - th2dot + th3dot - th4dot)*(th1dot - th2dot + th3dot - th4dot) - (forearm*cos(th1 - th2 + th3 - th4 - th5)*(th2dot - th1dot - th3dot + th4dot + th5dot)*(th2dot - th1dot - th3dot + th4dot + th5dot))/2) + m4*(spine*sin(th1 - th2 + th3)*(th1dot - th2dot + th3dot) + thigh*sin(th1 - th2)*(th1dot - th2dot))*(spine*cos(th1 - th2 + th3)*(th1dot - th2dot + th3dot) + thigh*cos(th1 - th2)*(th1dot - th2dot) + crus*cos(th1)*th1dot) - m3*thigh*cos(th1 - th2)*(crus*th1ddot*cos(th1) + thigh*cos(th1 - th2)*(th1ddot - th2ddot) - crus*th1dot*sin(th1)*th1dot - thigh*sin(th1 - th2)*(th1dot - th2dot)*(th1dot - th2dot)) - (m2*thigh*sin(th1 - th2)*(crus*th1ddot*sin(th1) + (thigh*sin(th1 - th2)*(th1ddot - th2ddot))/2 + crus*th1dot*cos(th1)*th1dot + (thigh*cos(th1 - th2)*(th1dot - th2dot)*(th1dot - th2dot))/2))/2 + m3*thigh*sin(th1 - th2)*(th1dot - th2dot)*(thigh*cos(th1 - th2)*(th1dot - th2dot) + crus*cos(th1)*th1dot) - (m2*thigh*cos(th1 - th2)*(th1dot - th2dot)*(crus*sin(th1)*th1dot + (thigh*sin(th1 - th2)*(th1dot - th2dot))/2))/2;

R3=m5*(spine*cos(th1 - th2 + th3) - bicep_arm*cos(th1 - th2 + th3 - th4))*(crus*th1ddot*cos(th1) - bicep_arm*cos(th1 - th2 + th3 - th4)*(th1ddot - th2ddot + th3ddot - th4ddot) + thigh*cos(th1 - th2)*(th1ddot - th2ddot) + spine*cos(th1 - th2 + th3)*(th1ddot - th2ddot + th3ddot) - crus*th1dot*sin(th1)*th1dot - spine*sin(th1 - th2 + th3)*(th1dot - th2dot + th3dot)*(th1dot - th2dot + th3dot) - thigh*sin(th1 - th2)*(th1dot - th2dot)*(th1dot - th2dot) + bicep_arm*sin(th1 - th2 + th3 - th4)*(th1dot - th2dot + th3dot - th4dot)*(th1dot - th2dot + th3dot - th4dot)) - m5*(spine*sin(th1 - th2 + th3)*(th1dot - th2dot + th3dot) - bicep_arm*sin(th1 - th2 + th3 - th4)*(th1dot - th2dot + th3dot - th4dot))*(spine*cos(th1 - th2 + th3)*(th1dot - th2dot + th3dot) + thigh*cos(th1 - th2)*(th1dot - th2dot) - bicep_arm*cos(th1 - th2 + th3 - th4)*(th1dot - th2dot + th3dot - th4dot) + crus*cos(th1)*th1dot) - m4*((bicep_arm*cos(th1 - th2 + th3 - th4)*(th1dot - th2dot + th3dot - th4dot))/2 - spine*cos(th1 - th2 + th3)*(th1dot - th2dot + th3dot))*(crus*sin(th1)*th1dot + spine*sin(th1 - th2 + th3)*(th1dot - th2dot + th3dot) + thigh*sin(th1 - th2)*(th1dot - th2dot) - (bicep_arm*sin(th1 - th2 + th3 - th4)*(th1dot - th2dot + th3dot - th4dot))/2) - m5*((forearm*sin(th1 - th2 + th3 - th4 - th5))/2 - spine*sin(th1 - th2 + th3) + bicep_arm*sin(th1 - th2 + th3 - th4))*(spine*sin(th1 - th2 + th3)*(th1ddot - th2ddot + th3ddot) + (forearm*sin(th1 - th2 + th3 - th4 - th5)*(th2ddot - th1ddot - th3ddot + th4ddot + th5ddot))/2 + crus*th1ddot*sin(th1) - bicep_arm*sin(th1 - th2 + th3 - th4)*(th1ddot - th2ddot + th3ddot - th4ddot) + thigh*sin(th1 - th2)*(th1ddot - th2ddot) + crus*th1dot*cos(th1)*th1dot + spine*cos(th1 - th2 + th3)*(th1dot - th2dot + th3dot)*(th1dot - th2dot + th3dot) + thigh*cos(th1 - th2)*(th1dot - th2dot)*(th1dot - th2dot) - bicep_arm*cos(th1 - th2 + th3 - th4)*(th1dot - th2dot + th3dot - th4dot)*(th1dot - th2dot + th3dot - th4dot) - (forearm*cos(th1 - th2 + th3 - th4 - th5)*(th2dot - th1dot - th3dot + th4dot + th5dot)*(th2dot - th1dot - th3dot + th4dot + th5dot))/2) + m5*((forearm*cos(th1 - th2 + th3 - th4 - th5)*(th2dot - th1dot - th3dot + th4dot + th5dot))/2 - bicep_arm*cos(th1 - th2 + th3 - th4)*(th1dot - th2dot + th3dot - th4dot) + spine*cos(th1 - th2 + th3)*(th1dot - th2dot + th3dot))*(crus*sin(th1)*th1dot + spine*sin(th1 - th2 + th3)*(th1dot - th2dot + th3dot) + thigh*sin(th1 - th2)*(th1dot - th2dot) - bicep_arm*sin(th1 - th2 + th3 - th4)*(th1dot - th2dot + th3dot - th4dot) + (forearm*sin(th1 - th2 + th3 - th4 - th5)*(th2dot - th1dot - th3dot + th4dot + th5dot))/2) + m4*(spine*sin(th1 - th2 + th3) - (bicep_arm*sin(th1 - th2 + th3 - th4))/2)*(spine*sin(th1 - th2 + th3)*(th1ddot - th2ddot + th3ddot) + crus*th1ddot*sin(th1) - (bicep_arm*sin(th1 - th2 + th3 - th4)*(th1ddot - th2ddot + th3ddot - th4ddot))/2 + thigh*sin(th1 - th2)*(th1ddot - th2ddot) + crus*th1dot*cos(th1)*th1dot + spine*cos(th1 - th2 + th3)*(th1dot - th2dot + th3dot)*(th1dot - th2dot + th3dot) + thigh*cos(th1 - th2)*(th1dot - th2dot)*(th1dot - th2dot) - (bicep_arm*cos(th1 - th2 + th3 - th4)*(th1dot - th2dot + th3dot - th4dot)*(th1dot - th2dot + th3dot - th4dot))/2) + m4*spine*cos(th1 - th2 + th3)*(crus*th1ddot*cos(th1) + thigh*cos(th1 - th2)*(th1ddot - th2ddot) + spine*cos(th1 - th2 + th3)*(th1ddot - th2ddot + th3ddot) - crus*th1dot*sin(th1)*th1dot - spine*sin(th1 - th2 + th3)*(th1dot - th2dot + th3dot)*(th1dot - th2dot + th3dot) - thigh*sin(th1 - th2)*(th1dot - th2dot)*(th1dot - th2dot)) + (m3*spine*sin(th1 - th2 + th3)*((spine*sin(th1 - th2 + th3)*(th1ddot - th2ddot + th3ddot))/2 + crus*th1ddot*sin(th1) + thigh*sin(th1 - th2)*(th1ddot - th2ddot) + crus*th1dot*cos(th1)*th1dot + (spine*cos(th1 - th2 + th3)*(th1dot - th2dot + th3dot)*(th1dot - th2dot + th3dot))/2 + thigh*cos(th1 - th2)*(th1dot - th2dot)*(th1dot - th2dot)))/2 - m4*spine*sin(th1 - th2 + th3)*(th1dot - th2dot + th3dot)*(spine*cos(th1 - th2 + th3)*(th1dot - th2dot + th3dot) + thigh*cos(th1 - th2)*(th1dot - th2dot) + crus*cos(th1)*th1dot) + (m3*spine*cos(th1 - th2 + th3)*(crus*sin(th1)*th1dot + (spine*sin(th1 - th2 + th3)*(th1dot - th2dot + th3dot))/2 + thigh*sin(th1 - th2)*(th1dot - th2dot))*(th1dot - th2dot + th3dot))/2;

R4=m5*((forearm*sin(th1 - th2 + th3 - th4 - th5))/2 + bicep_arm*sin(th1 - th2 + th3 - th4))*(spine*sin(th1 - th2 + th3)*(th1ddot - th2ddot + th3ddot) + (forearm*sin(th1 - th2 + th3 - th4 - th5)*(th2ddot - th1ddot - th3ddot + th4ddot + th5ddot))/2 + crus*th1ddot*sin(th1) - bicep_arm*sin(th1 - th2 + th3 - th4)*(th1ddot - th2ddot + th3ddot - th4ddot) + thigh*sin(th1 - th2)*(th1ddot - th2ddot) + crus*th1dot*cos(th1)*th1dot + spine*cos(th1 - th2 + th3)*(th1dot - th2dot + th3dot)*(th1dot - th2dot + th3dot) + thigh*cos(th1 - th2)*(th1dot - th2dot)*(th1dot - th2dot) - bicep_arm*cos(th1 - th2 + th3 - th4)*(th1dot - th2dot + th3dot - th4dot)*(th1dot - th2dot + th3dot - th4dot) - (forearm*cos(th1 - th2 + th3 - th4 - th5)*(th2dot - th1dot - th3dot + th4dot + th5dot)*(th2dot - th1dot - th3dot + th4dot + th5dot))/2) - m5*((forearm*cos(th1 - th2 + th3 - th4 - th5)*(th2dot - th1dot - th3dot + th4dot + th5dot))/2 - bicep_arm*cos(th1 - th2 + th3 - th4)*(th1dot - th2dot + th3dot - th4dot))*(crus*sin(th1)*th1dot + spine*sin(th1 - th2 + th3)*(th1dot - th2dot + th3dot) + thigh*sin(th1 - th2)*(th1dot - th2dot) - bicep_arm*sin(th1 - th2 + th3 - th4)*(th1dot - th2dot + th3dot - th4dot) + (forearm*sin(th1 - th2 + th3 - th4 - th5)*(th2dot - th1dot - th3dot + th4dot + th5dot))/2) + bicep_arm*m5*cos(th1 - th2 + th3 - th4)*(crus*th1ddot*cos(th1) - bicep_arm*cos(th1 - th2 + th3 - th4)*(th1ddot - th2ddot + th3ddot - th4ddot) + thigh*cos(th1 - th2)*(th1ddot - th2ddot) + spine*cos(th1 - th2 + th3)*(th1ddot - th2ddot + th3ddot) - crus*th1dot*sin(th1)*th1dot - spine*sin(th1 - th2 + th3)*(th1dot - th2dot + th3dot)*(th1dot - th2dot + th3dot) - thigh*sin(th1 - th2)*(th1dot - th2dot)*(th1dot - th2dot) + bicep_arm*sin(th1 - th2 + th3 - th4)*(th1dot - th2dot + th3dot - th4dot)*(th1dot - th2dot + th3dot - th4dot)) + (bicep_arm*m4*sin(th1 - th2 + th3 - th4)*(spine*sin(th1 - th2 + th3)*(th1ddot - th2ddot + th3ddot) + crus*th1ddot*sin(th1) - (bicep_arm*sin(th1 - th2 + th3 - th4)*(th1ddot - th2ddot + th3ddot - th4ddot))/2 + thigh*sin(th1 - th2)*(th1ddot - th2ddot) + crus*th1dot*cos(th1)*th1dot + spine*cos(th1 - th2 + th3)*(th1dot - th2dot + th3dot)*(th1dot - th2dot + th3dot) + thigh*cos(th1 - th2)*(th1dot - th2dot)*(th1dot - th2dot) - (bicep_arm*cos(th1 - th2 + th3 - th4)*(th1dot - th2dot + th3dot - th4dot)*(th1dot - th2dot + th3dot - th4dot))/2))/2 - bicep_arm*m5*sin(th1 - th2 + th3 - th4)*(spine*cos(th1 - th2 + th3)*(th1dot - th2dot + th3dot) + thigh*cos(th1 - th2)*(th1dot - th2dot) - bicep_arm*cos(th1 - th2 + th3 - th4)*(th1dot - th2dot + th3dot - th4dot) + crus*cos(th1)*th1dot)*(th1dot - th2dot + th3dot - th4dot) + (bicep_arm*m4*cos(th1 - th2 + th3 - th4)*(crus*sin(th1)*th1dot + spine*sin(th1 - th2 + th3)*(th1dot - th2dot + th3dot) + thigh*sin(th1 - th2)*(th1dot - th2dot) - (bicep_arm*sin(th1 - th2 + th3 - th4)*(th1dot - th2dot + th3dot - th4dot))/2)*(th1dot - th2dot + th3dot - th4dot))/2;
 
R5=(forearm*m5*sin(th1 - th2 + th3 - th4 - th5)*(spine*sin(th1 - th2 + th3)*(th1ddot - th2ddot + th3ddot) + (forearm*sin(th1 - th2 + th3 - th4 - th5)*(th2ddot - th1ddot - th3ddot + th4ddot + th5ddot))/2 + crus*th1ddot*sin(th1) - bicep_arm*sin(th1 - th2 + th3 - th4)*(th1ddot - th2ddot + th3ddot - th4ddot) + thigh*sin(th1 - th2)*(th1ddot - th2ddot) + crus*th1dot*cos(th1)*th1dot + spine*cos(th1 - th2 + th3)*(th1dot - th2dot + th3dot)*(th1dot - th2dot + th3dot) + thigh*cos(th1 - th2)*(th1dot - th2dot)*(th1dot - th2dot) - bicep_arm*cos(th1 - th2 + th3 - th4)*(th1dot - th2dot + th3dot - th4dot)*(th1dot - th2dot + th3dot - th4dot) - (forearm*cos(th1 - th2 + th3 - th4 - th5)*(th2dot - th1dot - th3dot + th4dot + th5dot)*(th2dot - th1dot - th3dot + th4dot + th5dot))/2))/2 - (forearm*m5*cos(th1 - th2 + th3 - th4 - th5)*(crus*sin(th1)*th1dot + spine*sin(th1 - th2 + th3)*(th1dot - th2dot + th3dot) + thigh*sin(th1 - th2)*(th1dot - th2dot) - bicep_arm*sin(th1 - th2 + th3 - th4)*(th1dot - th2dot + th3dot - th4dot) + (forearm*sin(th1 - th2 + th3 - th4 - th5)*(th2dot - th1dot - th3dot + th4dot + th5dot))/2)*(th2dot - th1dot - th3dot + th4dot + th5dot))/2;



tau1 =  R1 - P1;
tau2 =  R2 - P2;
tau3 =  R3 - P3;
tau4 =  R4 - P4;
tau5 =  R5 - P5;

